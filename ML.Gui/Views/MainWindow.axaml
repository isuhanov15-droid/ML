<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:ML.Gui.ViewModels"
        xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.Avalonia;assembly=LiveChartsCore.SkiaSharpView.Avalonia"
        x:Class="ML.Gui.Views.MainWindow"
        Title="ML Trainer Dashboard"
        Width="1280" Height="820"
        Background="#0F1115"
        mc:Ignorable="d">
  <Design.DataContext>
    <vm:MainViewModel/>
  </Design.DataContext>

  <Grid RowDefinitions="Auto,Auto,*" ColumnDefinitions="*">
    <!-- Меню -->
    <Menu Grid.Row="0" Background="#161920" Foreground="#E5E5E5">
      <MenuItem Header="_Файл">
        <MenuItem Header="Сохранить модель" Command="{Binding Training.SaveModelCommand}"/>
        <MenuItem Header="Загрузить модель" Command="{Binding Training.LoadModelCommand}"/>
      </MenuItem>
      <MenuItem Header="_Вид">
        <MenuItem Header="Тёмная тема (по умолчанию)" IsEnabled="False"/>
      </MenuItem>
      <MenuItem Header="_Справка">
        <MenuItem Header="Demo: XOR датасет" IsEnabled="False"/>
      </MenuItem>
    </Menu>

    <!-- Заголовок / статус -->
    <Border Grid.Row="1" Background="#11141B" Padding="16" BorderBrush="#1F2633" BorderThickness="0,0,0,1">
      <DockPanel>
        <StackPanel Orientation="Vertical" DockPanel.Dock="Left">
          <TextBlock Text="ML Trainer Dashboard" Foreground="White" FontSize="22" FontWeight="Bold"/>
          <TextBlock Text="Управление обучением, метрики, модели" Foreground="#9BA5B5" FontSize="13"/>
        </StackPanel>
        <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Right">
          <Button Content="Start" Command="{Binding Training.StartCommand}" MinWidth="90" Padding="10,6"/>
          <Button Content="Stop" Command="{Binding Training.StopCommand}" MinWidth="90" Padding="10,6"/>
          <Border Background="#1E2938" Padding="8,4" CornerRadius="6">
            <TextBlock Text="{Binding Training.Status}" Foreground="#E5E5E5"/>
          </Border>
          <Border Background="#17202D" Padding="8,4" CornerRadius="6">
            <TextBlock Text="Demo: XOR" Foreground="#9BA5B5"/>
          </Border>
        </StackPanel>
      </DockPanel>
    </Border>

    <!-- Основная зона -->
    <TabControl Grid.Row="2" Background="#0F1115">
      <TabItem Header="Конфигурация">
        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
          <Border Padding="12">
            <StackPanel Spacing="10">
              <TextBlock Text="Данные" FontWeight="Bold" FontSize="16" Foreground="#E5E5E5"/>
              <TextBox Width="320" HorizontalAlignment="Left" Text="{Binding Training.DatasetPath}" Watermark="path/to/dataset.csv"/>
              <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                <TextBlock Text="Пример" Foreground="#C7CEDB" Width="80"/>
                <ComboBox Width="180" ItemsSource="{Binding Training.Presets}" SelectedItem="{Binding Training.SelectedPreset}">
                  <ComboBox.ItemTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding Name}" />
                    </DataTemplate>
                  </ComboBox.ItemTemplate>
                </ComboBox>
                <Button Content="Применить" Command="{Binding Training.ApplyPresetCommand}" Width="90"/>
              </StackPanel>
              <Border Height="1" Background="#1F2633" Margin="0,8,0,8"/>

              <StackPanel Spacing="12">
                <TextBlock Text="Модель" FontWeight="Bold" FontSize="16" Foreground="#E5E5E5"/>
                <UniformGrid Columns="4" Rows="1" Margin="0,4,0,0" HorizontalAlignment="Left">
                  <StackPanel Width="120" HorizontalAlignment="Left" Margin="0,0,8,0">
                    <TextBlock Text="Input" Foreground="#C7CEDB"/>
                    <TextBox Width="110" Text="{Binding Training.InputSize}"/>
                  </StackPanel>
                  <StackPanel Width="120" HorizontalAlignment="Left" Margin="0,0,8,0">
                    <TextBlock Text="Output" Foreground="#C7CEDB"/>
                    <TextBox Width="110" Text="{Binding Training.OutputSize}"/>
                  </StackPanel>
                  <StackPanel Width="140" HorizontalAlignment="Left" Margin="0,0,8,0">
                    <TextBlock Text="Hidden" Foreground="#C7CEDB"/>
                    <TextBox Width="130" Text="{Binding Training.HiddenSizes}" Watermark="4,8,4"/>
                  </StackPanel>
                  <StackPanel Width="140" HorizontalAlignment="Left">
                    <TextBlock Text="Activation" Foreground="#C7CEDB"/>
                    <ComboBox Width="130" ItemsSource="{Binding Training.ActivationOptions}"
                              SelectedItem="{Binding Training.Activation}"/>
                  </StackPanel>
                </UniformGrid>
                <Border Height="1" Background="#1F2633" Margin="0,6,0,6"/>

                <TextBlock Text="Обучение" FontWeight="Bold" FontSize="16" Foreground="#E5E5E5"/>
                <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Left">
                  <StackPanel Width="120" HorizontalAlignment="Left" Margin="0,0,8,0">
                    <TextBlock Text="Epochs" Foreground="#C7CEDB"/>
                    <TextBox Width="110" Text="{Binding Training.EpochsCount}"/>
                  </StackPanel>
                  <StackPanel Width="120" HorizontalAlignment="Left" Margin="0,0,8,0">
                    <TextBlock Text="Batch" Foreground="#C7CEDB"/>
                    <TextBox Width="110" Text="{Binding Training.BatchSize}"/>
                  </StackPanel>
                  <StackPanel Width="120" HorizontalAlignment="Left" Margin="0,0,8,0">
                    <TextBlock Text="Accum" Foreground="#C7CEDB"/>
                    <TextBox Width="110" Text="{Binding Training.AccumulationSteps}"/>
                  </StackPanel>
                  <StackPanel Width="160" HorizontalAlignment="Left" Margin="0,0,8,0">
                    <TextBlock Text="Каждую N эпоху" Foreground="#C7CEDB"/>
                    <TextBox Width="90" Text="{Binding Training.EpochDisplayEvery}"/>
                  </StackPanel>
                  <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom" HorizontalAlignment="Left">
                    <CheckBox Content="Shuffle" IsChecked="{Binding Training.Shuffle}"/>
                    <CheckBox Content="Drop" IsChecked="{Binding Training.DropLast}"/>
                  </StackPanel>
                </StackPanel>
                <Border Height="1" Background="#1F2633" Margin="0,6,0,6"/>

                <TextBlock Text="Оптимизатор (Adam)" FontWeight="Bold" FontSize="16" Foreground="#E5E5E5"/>
                <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Left">
                  <StackPanel Width="110" HorizontalAlignment="Left">
                    <TextBlock Text="LR" Foreground="#C7CEDB"/>
                    <TextBox Width="100" Text="{Binding Training.LearningRate}"/>
                  </StackPanel>
                  <StackPanel Width="110" HorizontalAlignment="Left">
                    <TextBlock Text="Grad clip" Foreground="#C7CEDB"/>
                    <TextBox Width="100" Text="{Binding Training.GradClipNorm}"/>
                  </StackPanel>
                  <StackPanel Width="110" HorizontalAlignment="Left">
                    <TextBlock Text="Seed" Foreground="#C7CEDB"/>
                    <TextBox Width="100" Text="{Binding Training.Seed}"/>
                  </StackPanel>
                </StackPanel>
                <Border Height="1" Background="#1F2633" Margin="0,6,0,6"/>

                <TextBlock Text="Сохранение/загрузка" FontWeight="Bold" FontSize="16" Foreground="#E5E5E5"/>
                <StackPanel Orientation="Vertical" Spacing="6">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Имя" Width="60" VerticalAlignment="Center" Foreground="#C7CEDB"/>
                    <TextBox Width="180" Text="{Binding Training.ModelName}" Watermark="model_name"/>
                  </StackPanel>
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Сохранить" Width="80" VerticalAlignment="Center" Foreground="#C7CEDB"/>
                    <TextBox Width="240" Text="{Binding Training.SavePath}" Watermark="(пусто = ML/Models/&lt;name&gt;.json)"/>
                    <Button Content="..." Width="28" Click="OnBrowseSave"/>
                    <Button Content="Save" Command="{Binding Training.SaveModelCommand}" Width="70"/>
                  </StackPanel>
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Загрузить" Width="80" VerticalAlignment="Center" Foreground="#C7CEDB"/>
                    <TextBox Width="240" Text="{Binding Training.LoadPath}" Watermark="(пусто = ML/Models/&lt;name&gt;.json)"/>
                    <Button Content="..." Width="28" Click="OnBrowseLoad"/>
                    <Button Content="Load" Command="{Binding Training.LoadModelCommand}" Width="70"/>
                  </StackPanel>
                </StackPanel>
              </StackPanel>

              <TextBlock Text="По умолчанию настроен демонстрационный XOR. Подключите свой пайплайн в MainWindow.axaml.cs." FontSize="12" Foreground="#6C7687"/>
            </StackPanel>
          </Border>
        </ScrollViewer>
      </TabItem>

      <TabItem Header="Метрики">
        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
          <Border Padding="12">
            <StackPanel Spacing="12">
              <UniformGrid Columns="3" Rows="1" Margin="0,0,0,8">
                <Border Background="#161B23" CornerRadius="8" Padding="12" Margin="0,0,8,0">
                  <StackPanel>
                    <TextBlock Text="Learning rate" Foreground="#9BA5B5" FontSize="12"/>
                    <TextBlock Text="{Binding Training.LearningRate}" Foreground="#E5E5E5" FontSize="18" FontWeight="Bold"/>
                  </StackPanel>
                </Border>
                <Border Background="#161B23" CornerRadius="8" Padding="12" Margin="0,0,8,0">
                  <StackPanel>
                    <TextBlock Text="Epochs planned" Foreground="#9BA5B5" FontSize="12"/>
                    <TextBlock Text="{Binding Training.EpochsCount}" Foreground="#E5E5E5" FontSize="18" FontWeight="Bold"/>
                  </StackPanel>
                </Border>
                <Border Background="#161B23" CornerRadius="8" Padding="12">
                  <StackPanel>
                    <TextBlock Text="Batch size" Foreground="#9BA5B5" FontSize="12"/>
                    <TextBlock Text="{Binding Training.BatchSize}" Foreground="#E5E5E5" FontSize="18" FontWeight="Bold"/>
                  </StackPanel>
                </Border>
              </UniformGrid>

              <Grid ColumnDefinitions="2*,*" RowDefinitions="*">
                <Border Grid.Column="0" Background="#121722" CornerRadius="10" Padding="12" BorderBrush="#1F2633" BorderThickness="1" Margin="0,0,10,0">
                  <StackPanel Spacing="6">
                    <TextBlock Text="Loss curve" Foreground="#E5E5E5" FontWeight="Bold"/>
                    <lvc:CartesianChart Series="{Binding Training.Series}"
                                        XAxes="{Binding Training.XAxes}"
                                        YAxes="{Binding Training.YAxes}"
                                        Height="360"
                                        LegendPosition="Right" />
                  </StackPanel>
                </Border>

                <Border Grid.Column="1" Background="#11161F" CornerRadius="10" Padding="12" BorderBrush="#1F2633" BorderThickness="1">
                  <StackPanel Spacing="8">
                    <TextBlock Text="Logs / Accuracy" Foreground="#E5E5E5" FontWeight="Bold"/>
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Height="360">
                      <TextBox Text="{Binding Training.LogText}"
                               AcceptsReturn="True"
                               IsReadOnly="True"
                               TextWrapping="Wrap"
                               Background="#0F1115"
                               Foreground="#E5E5E5"
                               BorderBrush="#1F2633"/>
                    </ScrollViewer>
                  </StackPanel>
                </Border>
              </Grid>
            </StackPanel>
          </Border>
        </ScrollViewer>
      </TabItem>
    </TabControl>
  </Grid>
</Window>
